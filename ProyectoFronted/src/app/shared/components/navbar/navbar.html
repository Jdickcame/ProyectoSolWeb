<nav class="navbar navbar-expand-lg navbar-dark bg-dark-theme sticky-top">
  <div class="container-fluid px-4">
    <!-- Logo -->
    <a class="navbar-brand" routerLink="/home">
      <span class="text-gradient fw-bold fs-4">EduConect</span>
    </a>

    <!-- Toggle button -->
    <button 
      class="navbar-toggler" 
      type="button" 
      data-bs-toggle="collapse" 
      data-bs-target="#navbarContent"
      aria-controls="navbarContent" 
      aria-expanded="false" 
      aria-label="Alternar navegación">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarContent">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item">
          <a class="nav-link" routerLink="/home" routerLinkActive="active">
            <i class="bi bi-house-door me-1" aria-hidden="true"></i>Inicio
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" routerLink="/courses" routerLinkActive="active">
            <i class="bi bi-book me-1" aria-hidden="true"></i>Explorar Cursos
          </a>
        </li>

        <!-- ENLACE DE MENSAJES (Solo si está logueado) -->
        @if (isAuthenticated() && !isAdmin()) {
          <li class="nav-item position-relative">
            <a class="nav-link" 
               [routerLink]="isTeacher() ? '/teacher/messages' : '/student/messages'" 
               routerLinkActive="active">
              <i class="bi bi-envelope me-1"></i> Mensajes
              
              @if (messageService.unreadCount() > 0) {
                <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" 
                      style="font-size: 0.6rem; margin-top: 8px; margin-left: -5px;">
                  {{ messageService.unreadCount() > 99 ? '99+' : messageService.unreadCount() }}
                  <span class="visually-hidden">mensajes no leídos</span>
                </span>
              }
            </a>
          </li>

          @if (isTeacher()) {
            <li class="nav-item">
              <a class="nav-link" routerLink="/teacher/dashboard" routerLinkActive="active">
                <i class="bi bi-easel me-1" aria-hidden="true"></i>Mis Cursos
              </a>
            </li>
          }
        }
      </ul>

      <!-- Lado Derecho (User Menu) -->
      <div class="d-flex align-items-center gap-3">
        @if (!isAuthenticated()) {
          <a routerLink="/auth/login" class="btn btn-outline-light btn-sm">
            Iniciar Sesión
          </a>
          <a routerLink="/auth/register" class="btn btn-gradient btn-sm">
            Registrarse
          </a>
        } @else {
          <div class="dropdown">
            <button 
              class="btn btn-link text-white text-decoration-none dropdown-toggle d-flex align-items-center gap-2" 
              type="button" 
              data-bs-toggle="dropdown" 
              aria-expanded="false">
              <img 
                [src]="userAvatar()" 
                alt="" 
                class="rounded-circle"
                width="32"
                height="32">
              <span class="d-none d-md-inline">{{ fullName() }}</span>
            </button>
            <ul class="dropdown-menu dropdown-menu-end">
              @if (isStudent()) {
                <li>
                  <a class="dropdown-item" routerLink="/student/dashboard">
                    <i class="bi bi-speedometer2 me-2"></i>Mi Dashboard
                  </a>
                </li>
                <li>
                  <a class="dropdown-item" routerLink="/student/my-courses">
                    <i class="bi bi-collection me-2"></i>Mis Cursos
                  </a>
                </li>
              }
              @if (isTeacher()) {
                <li>
                  <a class="dropdown-item" routerLink="/teacher/dashboard">
                    <i class="bi bi-speedometer2 me-2"></i>Mi Dashboard
                  </a>
                </li>
                <li>
                  <a class="dropdown-item" routerLink="/teacher/my-courses">
                    <i class="bi bi-collection me-2"></i>Mis Cursos
                  </a>
                </li>
              }
              @if (isAdmin()) {
                <li>
                  <a class="dropdown-item" routerLink="/admin/dashboard">
                    <i class="bi bi-shield-check me-2"></i>Panel Admin
                  </a>
                </li>
              }
              <li><hr class="dropdown-divider"></li>
              <li>
                <a class="dropdown-item" routerLink="/profile">
                  <i class="bi bi-person me-2"></i>Mi Perfil
                </a>
              </li>
              <li>
                <button class="dropdown-item" (click)="logout()">
                  <i class="bi bi-box-arrow-right me-2"></i>Cerrar Sesión
                </button>
              </li>
            </ul>
          </div>
        }
      </div>
    </div>
  </div>
</nav>